{"version":3,"sources":["index.js","constants.js","format.js","options.js","util/object.js","parse/index.js","parse/hrefInfo.js","parse/host.js","parse/path.js","parse/port.js","parse/query.js","parse/urlstring.js","util/path.js","relate/index.js","relate/absolutize.js","relate/findRelation.js","relate/relativize.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;ACFA,ADGA;ACFA,ADGA;ACFA,ADGA;ACFA,ACHA,AFMA;ACFA,ACHA,AFMA;ACFA,ACHA,AFMA;ACFA,ACHA,AFMA,AGTA;AFOA,ACHA,AFMA,AGTA;AFOA,ACHA,AFMA,AGTA;AFOA,ACHA,AFMA,AGTA,ACHA;AHUA,ACHA,AFMA,AGTA,ACHA;AFOA,AFMA,AGTA,ACHA;AFOA,AFMA,AGTA,AENA,ADGA;AFOA,AFMA,AGTA,AENA,ADGA;AFOA,AFMA,AGTA,AENA,ADGA;AFOA,AFMA,AGTA,AGTA,ADGA,ADGA;AFOA,AFMA,AGTA,AGTA,ADGA,ADGA;AFOA,AFMA,AGTA,AGTA,ADGA,ADGA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,ADGA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,ADGA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,ADGA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,AJYA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,AJYA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,AJYA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ALeA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ALeA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ALeA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ACHA,ANkBA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ACHA,ANkBA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ACHA,ANkBA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ACHA,ACHA,APqBA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ACHA,ACHA,APqBA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ACHA,ACHA,APqBA;AFOA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ACHA,ACHA,APqBA,AQxBA;AV+BA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ACHA,ACHA,APqBA,AQxBA;AV+BA,AFMA,AGTA,AIZA,ADGA,ADGA,AGTA,ACHA,ACHA,ACHA,APqBA,AQxBA;AV+BA,AFMA,AGTA,AIZA,AFMA,AGTA,ACHA,ACHA,ACHA,AENA,AT2BA,AQxBA;AV+BA,AFMA,AGTA,AIZA,AFMA,AGTA,ACHA,ACHA,ACHA,AENA,AT2BA,AQxBA;AV+BA,AFMA,AGTA,AIZA,AFMA,AGTA,ACHA,ACHA,ACHA,AENA,AT2BA,AQxBA;AV+BA,AFMA,AGTA,AIZA,AFMA,AGTA,ACHA,ACHA,ACHA,AGTA,ADGA,AT2BA,AQxBA;AV+BA,AFMA,AGTA,AIZA,AFMA,AGTA,ACHA,ACHA,ACHA,AGTA,ADGA,AT2BA,AQxBA;AV+BA,AFMA,AGTA,AIZA,AFMA,AGTA,ACHA,ACHA,ACHA,AGTA,ADGA,AT2BA,AQxBA;AV+BA,AFMA,AGTA,AIZA,AFMA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AT2BA,AQxBA;AV+BA,AFMA,AGTA,AIZA,AFMA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AT2BA,AQxBA;AV+BA,AFMA,AGTA,AIZA,AFMA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AT2BA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AGTA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AGTA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AGTA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AGTA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AGTA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AGTA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AGTA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AGTA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AGTA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,AFMA,AGTA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,ACHA,ACHA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AGTA,AENA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AKfA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AKfA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AKfA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AKfA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AKfA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AKfA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AKfA,AGTA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AQxBA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AQxBA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AQxBA,AENA,ACHA,AGTA,ACHA,ACHA,AZoCA,AQxBA;AV+BA,AFMA,AQxBA,AENA,ACHA,AGTA,ACHA,ACHA,AJYA;AV+BA,AFMA,AQxBA,AENA,ACHA,AGTA,ACHA,ACHA,AJYA;AV+BA,AFMA,AQxBA,AENA,ACHA,AGTA,ACHA,ACHA,AJYA;AV+BA,AFMA,AQxBA,AENA,ACHA,AGTA,ACHA,ACHA,AJYA;AV+BA,AFMA,AQxBA,AENA,ACHA,AGTA,ACHA,ACHA,AJYA;AV+BA,AFMA,AQxBA,AENA,ACHA,AGTA,ACHA,ACHA,AJYA;AV+BA,AFMA,AQxBA,AENA,ACHA,AGTA,ACHA,ACHA,AJYA;AV+BA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA,AJYA;AV+BA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA,AJYA;AV+BA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AFMA,AQxBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA,ACHA;Ad2CA,AMlBA,AGTA,AGTA,ACHA;AbwCA,AMlBA,AGTA,AGTA,ACHA;AbwCA,AMlBA,AGTA,AGTA,ACHA;AbwCA,AMlBA,AGTA,AGTA,ACHA;AbwCA,AMlBA,AGTA,AGTA,ACHA;AbwCA,AMlBA,AGTA,AGTA,ACHA;AbwCA,AMlBA,AGTA,AGTA,ACHA;AbwCA,AMlBA,AGTA,AGTA,ACHA;AbwCA,AMlBA,AGTA,AGTA,ACHA;AbwCA,AS3BA,AGTA;AZqCA,AS3BA,AGTA;AZqCA,AS3BA,AGTA;AZqCA,AS3BA,AGTA;AZqCA,AS3BA,AGTA;AZqCA,AS3BA,AGTA;AZqCA,AS3BA,AGTA;AZqCA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA,AS3BA;AT4BA","file":"index.js","sourcesContent":["\n\nvar constants  = require(\"./constants\");\nvar formatUrl  = require(\"./format\");\nvar getOptions = require(\"./options\");\nvar objUtils   = require(\"./util/object\");\nvar parseUrl   = require(\"./parse\");\nvar relateUrl  = require(\"./relate\");\n\n\n\nfunction RelateUrl(from, options)\n{\n\tthis.options = getOptions(options,\n\t{\n\t\tdefaultPorts: {ftp:21, http:80, https:443},\n\t\tdirectoryIndexes: [\"index.html\"],\n\t\tignore_www: false,\n\t\toutput: RelateUrl.SHORTEST,\n\t\trejectedSchemes: [\"data\",\"javascript\",\"mailto\"],\n\t\tremoveAuth: false,\n\t\tremoveDirectoryIndexes: true,\n\t\tremoveEmptyQueries: false,\n\t\tremoveRootTrailingSlash: true,\n\t\tschemeRelative: true,\n\t\tsite: undefined,\n\t\tslashesDenoteHost: true\n\t});\n\t\n\tthis.from = parseUrl.from(from, this.options, null);\n}\n\n\n\n/*\n\tUsage: instance=new RelateUrl(); instance.relate();\n*/\nRelateUrl.prototype.relate = function(from, to, options)\n{\n\t// relate(to,options)\n\tif ( objUtils.isPlainObject(to) )\n\t{\n\t\toptions = to;\n\t\tto = from;\n\t\tfrom = null;\n\t}\n\t// relate(to)\n\telse if (!to)\n\t{\n\t\tto = from;\n\t\tfrom = null;\n\t}\n\t\n\toptions = getOptions(options, this.options);\n\tfrom = from || options.site;\n\tfrom = parseUrl.from(from, options, this.from);\n\t\n\tif (!from || !from.href)\n\t{\n\t\tthrow new Error(\"from value not defined.\");\n\t}\n\telse if (from.extra.hrefInfo.minimumPathOnly)\n\t{\n\t\tthrow new Error(\"from value supplied is not absolute: \"+from.href);\n\t}\n\t\n\tto = parseUrl.to(to, options);\n\t\n\tif (to.valid===false) return to.href;\n\t\n\tto = relateUrl(from, to, options);\n\tto = formatUrl(to, options);\n\t\n\treturn to;\n}\n\n\n\n/*\n\tUsage: RelateUrl.relate();\n*/\nRelateUrl.relate = function(from, to, options)\n{\n\treturn new RelateUrl().relate(from, to, options);\n}\n\n\n\n// Make constants accessible from API\nobjUtils.shallowMerge(RelateUrl, constants);\n\n\n\nmodule.exports = RelateUrl;\n","\n\nmodule.exports =\n{\n\t// Output\n\tABSOLUTE:      \"absolute\",\n\tPATH_RELATIVE: \"pathRelative\",\n\tROOT_RELATIVE: \"rootRelative\",\n\tSHORTEST:      \"shortest\"\n};\n","\n\nvar constants = require(\"./constants\");\n\n\n\nfunction formatAuth(urlObj, options)\n{\n\tif (urlObj.auth && !options.removeAuth && (urlObj.extra.relation.maximumHost || options.output===constants.ABSOLUTE))\n\t{\n\t\treturn urlObj.auth + \"@\";\n\t}\n\t\n\treturn \"\";\n}\n\n\n\nfunction formatHash(urlObj, options)\n{\n\treturn urlObj.hash ? urlObj.hash : \"\";\n}\n\n\n\nfunction formatHost(urlObj, options)\n{\n\tif (urlObj.host.full && (urlObj.extra.relation.maximumAuth || options.output===constants.ABSOLUTE))\n\t{\n\t\treturn urlObj.host.full;\n\t}\n\t\n\treturn \"\";\n}\n\n\n\nfunction formatPath(urlObj, options)\n{\n\tvar str = \"\";\n\t\n\tvar absolutePath = urlObj.path.absolute.string;\n\tvar relativePath = urlObj.path.relative.string;\n\tvar resource = showResource(urlObj, options);\n\t\n\tif (urlObj.extra.relation.maximumHost || options.output===constants.ABSOLUTE || options.output===constants.ROOT_RELATIVE)\n\t{\n\t\tstr = absolutePath;\n\t}\n\telse if (relativePath.length<=absolutePath.length && options.output===constants.SHORTEST || options.output===constants.PATH_RELATIVE)\n\t{\n\t\tstr = relativePath;\n\t\t\n\t\tif (str === \"\")\n\t\t{\n\t\t\tvar query = showQuery(urlObj,options) && !!getQuery(urlObj,options);\n\t\t\t\n\t\t\tif (urlObj.extra.relation.maximumPath && !resource)\n\t\t\t{\n\t\t\t\tstr = \"./\";\n\t\t\t}\n\t\t\telse if (urlObj.extra.relation.overridesQuery && !resource && !query)\n\t\t\t{\n\t\t\t\tstr = \"./\";\n\t\t\t}\n\t\t}\n\t}\n\telse\n\t{\n\t\tstr = absolutePath;\n\t}\n\t\n\tif ( str===\"/\" && !resource && options.removeRootTrailingSlash && (!urlObj.extra.relation.minimumPort || options.output===constants.ABSOLUTE) )\n\t{\n\t\tstr = \"\";\n\t}\n\t\n\treturn str;\n}\n\n\n\nfunction formatPort(urlObj, options)\n{\n\tif (urlObj.port && !urlObj.extra.portIsDefault && urlObj.extra.relation.maximumHost)\n\t{\n\t\treturn \":\" + urlObj.port;\n\t}\n\t\n\treturn \"\";\n}\n\n\n\nfunction formatQuery(urlObj, options)\n{\n\treturn showQuery(urlObj,options) ? getQuery(urlObj, options) : \"\";\n}\n\n\n\nfunction formatResource(urlObj, options)\n{\n\treturn showResource(urlObj,options) ? urlObj.resource : \"\";\n}\n\n\n\nfunction formatScheme(urlObj, options)\n{\n\tvar str = \"\";\n\t\n\tif (urlObj.extra.relation.maximumHost || options.output===constants.ABSOLUTE)\n\t{\n\t\tif (!urlObj.extra.relation.minimumScheme || !options.schemeRelative || options.output===constants.ABSOLUTE)\n\t\t{\n\t\t\tstr += urlObj.scheme + \"://\";\n\t\t}\n\t\telse\n\t\t{\n\t\t\tstr += \"//\";\n\t\t}\n\t}\n\t\n\treturn str;\n}\n\n\n\nfunction formatUrl(urlObj, options)\n{\n\tvar url = \"\";\n\t\n\turl += formatScheme(urlObj, options);\n\turl += formatAuth(urlObj, options);\n\turl += formatHost(urlObj, options);\n\turl += formatPort(urlObj, options);\n\turl += formatPath(urlObj, options);\n\turl += formatResource(urlObj, options);\n\turl += formatQuery(urlObj, options);\n\turl += formatHash(urlObj, options);\n\t\n\treturn url;\n}\n\n\n\nfunction getQuery(urlObj, options)\n{\n\tvar stripQuery = options.removeEmptyQueries && urlObj.extra.relation.minimumPort;\n\t\n\treturn urlObj.query.string[ stripQuery ? \"stripped\" : \"full\" ];\n}\n\n\n\nfunction showQuery(urlObj, options)\n{\n\treturn !urlObj.extra.relation.minimumQuery || options.output===constants.ABSOLUTE || options.output===constants.ROOT_RELATIVE;\n}\n\n\n\nfunction showResource(urlObj, options)\n{\n\tvar removeIndex = options.removeDirectoryIndexes && urlObj.extra.resourceIsIndex;\n\tvar removeMatchingResource = urlObj.extra.relation.minimumResource && options.output!==constants.ABSOLUTE && options.output!==constants.ROOT_RELATIVE;\n\t\n\treturn !!urlObj.resource && !removeMatchingResource && !removeIndex;\n}\n\n\n\nmodule.exports = formatUrl;\n","\n\nvar objUtils = require(\"./util/object\");\n\n\n\nfunction getOptions(options, defaults)\n{\n\tif ( objUtils.isPlainObject(options) )\n\t{\n\t\tvar newOptions = {};\n\t\t\n\t\tfor (var i in defaults)\n\t\t{\n\t\t\tif ( defaults.hasOwnProperty(i) )\n\t\t\t{\n\t\t\t\tif (options[i] !== undefined)\n\t\t\t\t{\n\t\t\t\t\tnewOptions[i] = mergeOption(options[i], defaults[i]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tnewOptions[i] = defaults[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn newOptions;\n\t}\n\telse\n\t{\n\t\treturn defaults;\n\t}\n}\n\n\n\nfunction mergeOption(newValues, defaultValues)\n{\n\tif (defaultValues instanceof Object && newValues instanceof Object)\n\t{\n\t\tif (defaultValues instanceof Array && newValues instanceof Array)\n\t\t{\n\t\t\treturn defaultValues.concat(newValues);\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn objUtils.shallowMerge(newValues, defaultValues);\n\t\t}\n\t}\n\t\n\treturn newValues;\n}\n\n\n\nmodule.exports = getOptions;\n","\n\n/*\n\tDeep-clone an object.\n*/\nfunction clone(obj)\n{\n\tif (obj instanceof Object)\n\t{\n\t\tvar clonedObj = (obj instanceof Array) ? [] : {};\n\t\t\n\t\tfor (var i in obj)\n\t\t{\n\t\t\tif ( obj.hasOwnProperty(i) )\n\t\t\t{\n\t\t\t\tclonedObj[i] = clone( obj[i] );\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn clonedObj;\n\t}\n\t\n\treturn obj;\n}\n\n\n\n/*\n\thttps://github.com/jonschlinkert/is-plain-object\n*/\nfunction isPlainObject(obj)\n{\n\treturn !!obj && typeof obj===\"object\" && obj.constructor===Object;\n}\n\n\n\n/*\n\tShallow-merge two objects.\n*/\nfunction shallowMerge(target, source)\n{\n\tif (target instanceof Object && source instanceof Object)\n\t{\n\t\tfor (var i in source)\n\t\t{\n\t\t\tif ( source.hasOwnProperty(i) )\n\t\t\t{\n\t\t\t\ttarget[i] = source[i];\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn target;\n}\n\n\n\nmodule.exports =\n{\n\tclone: clone,\n\tisPlainObject: isPlainObject,\n\tshallowMerge: shallowMerge\n};\n","\n\nvar hrefInfo   = require(\"./hrefInfo\");\nvar parseHost  = require(\"./host\");\nvar parsePath  = require(\"./path\");\nvar parsePort  = require(\"./port\");\nvar parseQuery = require(\"./query\");\nvar parseUrlString = require(\"./urlstring\");\nvar pathUtils      = require(\"../util/path\");\n\n\n\nfunction parseFromUrl(url, options, fallback)\n{\n\tif (url)\n\t{\n\t\tvar urlObj = parseUrl(url, options);\n\t\t\n\t\t// Because the following occurs in the relate stage for \"to\" URLs,\n\t\t// such had to be mostly duplicated here\n\t\t\n\t\tvar pathArray = pathUtils.resolveDotSegments(urlObj.path.absolute.array);\n\t\t\n\t\turlObj.path.absolute.array  = pathArray;\n\t\turlObj.path.absolute.string = \"/\" + pathUtils.join(pathArray);\n\t\t\n\t\treturn urlObj;\n\t}\n\telse\n\t{\n\t\treturn fallback;\n\t}\n}\n\n\n\nfunction parseUrl(url, options)\n{\n\tvar urlObj = parseUrlString(url, options);\n\t\n\tif (urlObj.valid===false) return urlObj;\n\t\n\tparseHost(urlObj, options);\n\tparsePort(urlObj, options);\n\tparsePath(urlObj, options);\n\tparseQuery(urlObj, options);\n\threfInfo(urlObj);\n\t\n\treturn urlObj;\n}\n\n\n\nmodule.exports =\n{\n\tfrom: parseFromUrl,\n\tto:   parseUrl\n};\n","\n\nfunction hrefInfo(urlObj)\n{\n\tvar minimumPathOnly     = (!urlObj.scheme && !urlObj.auth && !urlObj.host.full && !urlObj.port);\n\tvar minimumResourceOnly = (minimumPathOnly && !urlObj.path.absolute.string);\n\tvar minimumQueryOnly    = (minimumResourceOnly && !urlObj.resource);\n\tvar minimumHashOnly     = (minimumQueryOnly && !urlObj.query.string.full.length);\n\tvar empty               = (minimumHashOnly && !urlObj.hash);\n\t\n\turlObj.extra.hrefInfo.minimumPathOnly     = minimumPathOnly;\n\turlObj.extra.hrefInfo.minimumResourceOnly = minimumResourceOnly;\n\turlObj.extra.hrefInfo.minimumQueryOnly    = minimumQueryOnly;\n\turlObj.extra.hrefInfo.minimumHashOnly     = minimumHashOnly;\n\turlObj.extra.hrefInfo.empty = empty;\n}\n\n\n\nmodule.exports = hrefInfo;\n","\n\nfunction parseHost(urlObj, options)\n{\n\t// TWEAK :: condition only for speed optimization\n\tif (options.ignore_www)\n\t{\n\t\tvar host = urlObj.host.full;\n\t\t\n\t\tif (host)\n\t\t{\n\t\t\tvar stripped = host;\n\t\t\t\n\t\t\tif (host.indexOf(\"www.\") === 0)\n\t\t\t{\n\t\t\t\tstripped = host.substr(4);\n\t\t\t}\n\t\t\t\n\t\t\turlObj.host.stripped = stripped;\n\t\t}\n\t}\n}\n\n\n\nmodule.exports = parseHost;\n","\n\nfunction isDirectoryIndex(resource, options)\n{\n\tvar verdict = false;\n\t\n\toptions.directoryIndexes.every( function(index)\n\t{\n\t\tif (index === resource)\n\t\t{\n\t\t\tverdict = true;\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\treturn true;\n\t});\n\t\n\treturn verdict;\n}\n\n\n\nfunction parsePath(urlObj, options)\n{\n\tvar path = urlObj.path.absolute.string;\n\t\n\tif (path)\n\t{\n\t\tvar lastSlash = path.lastIndexOf(\"/\");\n\t\t\n\t\tif (lastSlash > -1)\n\t\t{\n\t\t\tif (++lastSlash < path.length)\n\t\t\t{\n\t\t\t\tvar resource = path.substr(lastSlash);\n\t\t\t\t\n\t\t\t\tif (resource!==\".\" && resource!==\"..\")\n\t\t\t\t{\n\t\t\t\t\turlObj.resource = resource;\n\t\t\t\t\tpath = path.substr(0, lastSlash);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpath += \"/\";\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\turlObj.path.absolute.string = path;\n\t\t\turlObj.path.absolute.array = splitPath(path);\n\t\t}\n\t\telse if (path===\".\" || path===\"..\")\n\t\t{\n\t\t\t// \"..?var\", \"..#anchor\", etc ... not \"..index.html\"\n\t\t\tpath += \"/\";\n\t\t\t\n\t\t\turlObj.path.absolute.string = path;\n\t\t\turlObj.path.absolute.array = splitPath(path);\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Resource-only\n\t\t\turlObj.resource = path;\n\t\t\turlObj.path.absolute.string = null;\n\t\t}\n\t\t\n\t\turlObj.extra.resourceIsIndex = isDirectoryIndex(urlObj.resource, options);\n\t}\n\t// Else: query/hash-only or empty\n}\n\n\n\nfunction splitPath(path)\n{\n\t// TWEAK :: condition only for speed optimization\n\tif (path !== \"/\")\n\t{\n\t\tvar cleaned = [];\n\t\t\n\t\tpath.split(\"/\").forEach( function(dir)\n\t\t{\n\t\t\t// Cleanup -- splitting \"/dir/\" becomes [\"\",\"dir\",\"\"]\n\t\t\tif (dir !== \"\")\n\t\t\t{\n\t\t\t\tcleaned.push(dir);\n\t\t\t}\n\t\t});\n\t\t\n\t\treturn cleaned;\n\t}\n\telse\n\t{\n\t\t// Faster to skip the above block and just create an array\n\t\treturn [];\n\t}\n}\n\n\n\nmodule.exports = parsePath;\n","\n\nfunction parsePort(urlObj, options)\n{\n\tvar defaultPort = -1;\n\t\n\tfor (var i in options.defaultPorts)\n\t{\n\t\tif ( i===urlObj.scheme && options.defaultPorts.hasOwnProperty(i) )\n\t\t{\n\t\t\tdefaultPort = options.defaultPorts[i];\n\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tif (defaultPort > -1)\n\t{\n\t\t// Force same type as urlObj.port\n\t\tdefaultPort = defaultPort.toString();\n\t\t\n\t\tif (urlObj.port === null)\n\t\t{\n\t\t\turlObj.port = defaultPort;\n\t\t}\n\t\t\n\t\turlObj.extra.portIsDefault = (urlObj.port === defaultPort);\n\t}\n}\n\n\n\nmodule.exports = parsePort;\n","\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\n\n\nfunction parseQuery(urlObj, options)\n{\n\turlObj.query.string.full = stringify(urlObj.query.object, false);\n\t\n\t// TWEAK :: condition only for speed optimization\n\tif (options.removeEmptyQueries)\n\t{\n\t\turlObj.query.string.stripped = stringify(urlObj.query.object, true);\n\t}\n}\n\n\n\nfunction stringify(queryObj, removeEmptyQueries)\n{\n\tvar count = 0;\n\tvar str = \"\";\n\t\n\tfor (var i in queryObj)\n\t{\n\t\tif ( i!==\"\" && hasOwnProperty.call(queryObj, i)===true )\n\t\t{\n\t\t\tvar value = queryObj[i];\n\t\t\t\n\t\t\tif (value !== \"\" || !removeEmptyQueries)\n\t\t\t{\n\t\t\t\tstr += (++count===1) ? \"?\" : \"&\";\n\t\t\t\t\n\t\t\t\ti = encodeURIComponent(i);\n\t\t\t\t\n\t\t\t\tif (value !== \"\")\n\t\t\t\t{\n\t\t\t\t\tstr += i +\"=\"+ encodeURIComponent(value).replace(/%20/g,\"+\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstr += i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\t\n\treturn str;\n}\n\n\n\nmodule.exports = parseQuery;\n","\n\nvar _parseUrl = require(\"url\").parse;\n\n\n\n/*\n\tCustomize the URL object that Node generates\n\tbecause:\n\t\n\t* necessary data for later\n\t* urlObj.host is useless\n\t* urlObj.hostname is too long\n\t* urlObj.path is useless\n\t* urlObj.pathname is too long\n\t* urlObj.protocol is inaccurate; should be called \"scheme\"\n\t* urlObj.search is mostly useless\n*/\nfunction clean(urlObj)\n{\n\tvar scheme = urlObj.protocol;\n\t\n\tif (scheme)\n\t{\n\t\t// Remove \":\" suffix\n\t\tif (scheme.indexOf(\":\") === scheme.length-1)\n\t\t{\n\t\t\tscheme = scheme.substr(0, scheme.length-1);\n\t\t}\n\t}\n\t\n\turlObj.host =\n\t{\n\t\t// TODO :: unescape(encodeURIComponent(s)) ? ... http://ecmanaut.blogspot.ca/2006/07/encoding-decoding-utf8-in-javascript.html\n\t\tfull: urlObj.hostname,\n\t\tstripped: null\n\t};\n\t\n\turlObj.path =\n\t{\n\t\tabsolute:\n\t\t{\n\t\t\tarray: null,\n\t\t\tstring: urlObj.pathname\n\t\t},\n\t\trelative:\n\t\t{\n\t\t\tarray: null,\n\t\t\tstring: null\n\t\t}\n\t};\n\t\n\turlObj.query =\n\t{\n\t\tobject: urlObj.query,\n\t\tstring:\n\t\t{\n\t\t\tfull: null,\n\t\t\tstripped: null\n\t\t}\n\t};\n\t\n\turlObj.extra =\n\t{\n\t\threfInfo:\n\t\t{\n\t\t\tminimumPathOnly: null,\n\t\t\tminimumResourceOnly: null,\n\t\t\tminimumQueryOnly: null,\n\t\t\tminimumHashOnly: null,\n\t\t\tempty: null,\n\t\t\t\n\t\t\tseparatorOnlyQuery: urlObj.search===\"?\"\n\t\t},\n\t\tportIsDefault: null,\n\t\trelation:\n\t\t{\n\t\t\tmaximumScheme: null,\n\t\t\tmaximumAuth: null,\n\t\t\tmaximumHost: null,\n\t\t\tmaximumPort: null,\n\t\t\tmaximumPath: null,\n\t\t\tmaximumResource: null,\n\t\t\tmaximumQuery: null,\n\t\t\tmaximumHash: null,\n\t\t\t\n\t\t\tminimumScheme: null,\n\t\t\tminimumAuth: null,\n\t\t\tminimumHost: null,\n\t\t\tminimumPort: null,\n\t\t\tminimumPath: null,\n\t\t\tminimumResource: null,\n\t\t\tminimumQuery: null,\n\t\t\tminimumHash: null,\n\t\t\t\n\t\t\toverridesQuery: null\n\t\t},\n\t\tresourceIsIndex: null,\n\t\tslashes: urlObj.slashes\n\t};\n\t\n\turlObj.resource = null;\n\turlObj.scheme = scheme;\n\tdelete urlObj.hostname;\n\tdelete urlObj.pathname;\n\tdelete urlObj.protocol;\n\tdelete urlObj.search;\n\tdelete urlObj.slashes;\n\t\n\treturn urlObj;\n}\n\n\n\nfunction validScheme(url, options)\n{\n\tvar valid = true;\n\t\n\toptions.rejectedSchemes.every( function(rejectedScheme)\n\t{\n\t\tvalid = !(url.indexOf(rejectedScheme+\":\") === 0);\n\t\t\n\t\t// Break loop\n\t\treturn valid;\n\t});\n\t\n\treturn valid;\n}\n\n\n\nfunction parseUrlString(url, options)\n{\n\tif ( validScheme(url,options) )\n\t{\n\t\treturn clean( _parseUrl(url, true, options.slashesDenoteHost) );\n\t}\n\telse\n\t{\n\t\treturn {href:url, valid:false};\n\t}\n}\n\n\n\nmodule.exports = parseUrlString;\n","\n\nfunction joinPath(pathArray)\n{\n\tif (pathArray.length > 0)\n\t{\n\t\treturn pathArray.join(\"/\") + \"/\";\n\t}\n\telse\n\t{\n\t\treturn \"\";\n\t}\n}\n\n\n\nfunction resolveDotSegments(pathArray)\n{\n\tvar pathAbsolute = [];\n\t\n\tpathArray.forEach( function(dir)\n\t{\n\t\tif (dir !== \"..\")\n\t\t{\n\t\t\tif (dir !== \".\")\n\t\t\t{\n\t\t\t\tpathAbsolute.push(dir);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// Remove parent\n\t\t\tif (pathAbsolute.length > 0)\n\t\t\t{\n\t\t\t\tpathAbsolute.splice(pathAbsolute.length-1, 1);\n\t\t\t}\n\t\t}\n\t});\n\t\n\treturn pathAbsolute;\n}\n\n\n\nmodule.exports =\n{\n\tjoin: joinPath,\n\tresolveDotSegments: resolveDotSegments\n};\n","\n\nvar absolutize = require(\"./absolutize\");\nvar relativize = require(\"./relativize\");\n\n\n\nfunction relateUrl(siteUrlObj, urlObj, options)\n{\n\tabsolutize(urlObj, siteUrlObj, options);\n\trelativize(urlObj, siteUrlObj, options);\n\t\n\treturn urlObj;\n}\n\n\n\nmodule.exports = relateUrl;\n","\n\nvar findRelation = require(\"./findRelation\");\nvar objUtils     = require(\"../util/object\");\nvar pathUtils    = require(\"../util/path\");\n\n\n\nfunction absolutize(urlObj, siteUrlObj, options)\n{\n\tfindRelation.upToPath(urlObj, siteUrlObj, options);\n\t\n\t// Fill in relative URLs\n\tif (urlObj.extra.relation.minimumScheme) urlObj.scheme = siteUrlObj.scheme;\n\tif (urlObj.extra.relation.minimumAuth)   urlObj.auth   = siteUrlObj.auth;\n\tif (urlObj.extra.relation.minimumHost)   urlObj.host   = objUtils.clone(siteUrlObj.host);\n\tif (urlObj.extra.relation.minimumPort)   copyPort(urlObj, siteUrlObj);\n\tif (urlObj.extra.relation.minimumScheme) copyPath(urlObj, siteUrlObj);\n\t\n\t// Check remaining relativeness now that path has been copied and/or resolved\n\tfindRelation.pathOn(urlObj, siteUrlObj, options);\n\t\n\t// Fill in relative URLs\n\tif (urlObj.extra.relation.minimumResource) copyResource(urlObj, siteUrlObj);\n\tif (urlObj.extra.relation.minimumQuery)    urlObj.query = objUtils.clone(siteUrlObj.query);\n\tif (urlObj.extra.relation.minimumHash)     urlObj.hash  = siteUrlObj.hash;\n}\n\n\n\n/*\n\tGet an absolute path that's relative to site url.\n*/\nfunction copyPath(urlObj, siteUrlObj)\n{\n\tif (urlObj.extra.relation.maximumHost || !urlObj.extra.hrefInfo.minimumResourceOnly)\n\t{\n\t\tvar pathArray = urlObj.path.absolute.array;\n\t\tvar pathString = \"/\";\n\t\t\n\t\t// If not erroneous URL\n\t\tif (pathArray)\n\t\t{\n\t\t\t// If is relative path\n\t\t\tif (urlObj.extra.hrefInfo.minimumPathOnly && urlObj.path.absolute.string.indexOf(\"/\")!==0)\n\t\t\t{\n\t\t\t\t// Append path to site path\n\t\t\t\tpathArray = siteUrlObj.path.absolute.array.concat(pathArray);\n\t\t\t}\n\t\t\t\n\t\t\tpathArray   = pathUtils.resolveDotSegments(pathArray);\n\t\t\tpathString += pathUtils.join(pathArray);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tpathArray = [];\n\t\t}\n\t\t\n\t\turlObj.path.absolute.array  = pathArray;\n\t\turlObj.path.absolute.string = pathString;\n\t}\n\telse\n\t{\n\t\t// Resource-, query- or hash-only or empty\n\t\turlObj.path = objUtils.clone(siteUrlObj.path);\n\t}\n}\n\n\n\nfunction copyPort(urlObj, siteUrlObj)\n{\n\turlObj.port = siteUrlObj.port;\n\t\n\turlObj.extra.portIsDefault = siteUrlObj.extra.portIsDefault;\n}\n\n\n\nfunction copyResource(urlObj, siteUrlObj)\n{\n\turlObj.resource = siteUrlObj.resource;\n\t\n\turlObj.extra.resourceIsIndex = siteUrlObj.extra.resourceIsIndex;\n}\n\n\n\nmodule.exports = absolutize;\n","\n\nfunction findRelation_upToPath(urlObj, siteUrlObj, options)\n{\n\t// Path- or root-relative URL\n\tvar pathOnly = urlObj.extra.hrefInfo.minimumPathOnly;\n\t\n\t// Matching scheme, scheme-relative or path-only\n\tvar minimumScheme = (urlObj.scheme===siteUrlObj.scheme || !urlObj.scheme);\n\t\n\t// Matching auth, ignoring auth or path-only\n\tvar minimumAuth = minimumScheme && (urlObj.auth===siteUrlObj.auth || options.removeAuth || pathOnly);\n\t\n\t// Matching host or path-only\n\tvar www = options.ignore_www ? \"stripped\" : \"full\";\n\tvar minimumHost = minimumAuth && (urlObj.host[www]===siteUrlObj.host[www] || pathOnly);\n\t\n\t// Matching port or path-only\n\tvar minimumPort = minimumHost && (urlObj.port===siteUrlObj.port || pathOnly);\n\t\n\turlObj.extra.relation.minimumScheme = minimumScheme;\n\turlObj.extra.relation.minimumAuth   = minimumAuth;\n\turlObj.extra.relation.minimumHost   = minimumHost;\n\turlObj.extra.relation.minimumPort   = minimumPort;\n\t\n\turlObj.extra.relation.maximumScheme = !minimumScheme || minimumScheme && !minimumAuth;\n\turlObj.extra.relation.maximumAuth   = !minimumScheme || minimumScheme && !minimumHost;\n\turlObj.extra.relation.maximumHost   = !minimumScheme || minimumScheme && !minimumPort;\n}\n\n\n\nfunction findRelation_pathOn(urlObj, siteUrlObj, options)\n{\n\tvar queryOnly = urlObj.extra.hrefInfo.minimumQueryOnly;\n\tvar hashOnly  = urlObj.extra.hrefInfo.minimumHashOnly;\n\tvar empty     = urlObj.extra.hrefInfo.empty;\t// not required, but self-documenting\n\t\n\t// From upToPath()\n\tvar minimumPort   = urlObj.extra.relation.minimumPort;\n\tvar minimumScheme = urlObj.extra.relation.minimumScheme;\n\t\n\t// Matching port and path\n\tvar minimumPath = minimumPort && urlObj.path.absolute.string===siteUrlObj.path.absolute.string;\n\t\n\t// Matching resource or query/hash-only or empty\n\tvar matchingResource = (urlObj.resource===siteUrlObj.resource || !urlObj.resource && siteUrlObj.extra.resourceIsIndex) || (options.removeDirectoryIndexes && urlObj.extra.resourceIsIndex && !siteUrlObj.resource);\n\tvar minimumResource = minimumPath && (matchingResource || queryOnly || hashOnly || empty);\n\t\n\t// Matching query or hash-only/empty\n\tvar query = options.removeEmptyQueries ? \"stripped\" : \"full\";\n\tvar urlQuery = urlObj.query.string[query];\n\tvar siteUrlQuery = siteUrlObj.query.string[query];\n\tvar minimumQuery = (minimumResource && !!urlQuery && urlQuery===siteUrlQuery) || ((hashOnly || empty) && !urlObj.extra.hrefInfo.separatorOnlyQuery);\n\t\n\tvar minimumHash = minimumQuery && urlObj.hash===siteUrlObj.hash;\n\t\n\turlObj.extra.relation.minimumPath     = minimumPath;\n\turlObj.extra.relation.minimumResource = minimumResource;\n\turlObj.extra.relation.minimumQuery    = minimumQuery;\n\turlObj.extra.relation.minimumHash     = minimumHash;\n\t\n\turlObj.extra.relation.maximumPort     = !minimumScheme || minimumScheme && !minimumPath;\n\turlObj.extra.relation.maximumPath     = !minimumScheme || minimumScheme && !minimumResource;\n\turlObj.extra.relation.maximumResource = !minimumScheme || minimumScheme && !minimumQuery;\n\turlObj.extra.relation.maximumQuery    = !minimumScheme || minimumScheme && !minimumHash;\n\turlObj.extra.relation.maximumHash     = !minimumScheme || minimumScheme && !minimumHash;\t// there's nothing after hash, so it's the same as maximumQuery\n\t\n\t// Matching path and/or resource with existing but non-matching site query\n\turlObj.extra.relation.overridesQuery  = minimumPath && urlObj.extra.relation.maximumResource && !minimumQuery && !!siteUrlQuery;\n}\n\n\n\nmodule.exports =\n{\n\tpathOn:   findRelation_pathOn,\n\tupToPath: findRelation_upToPath\n};\n","\n\nvar pathUtils = require(\"../util/path\");\n\n\n\n/*\n\tGet a path relative to the site path.\n*/\nfunction relatePath(absolutePath, siteAbsolutePath)\n{\n\tvar relativePath = [];\n\t\n\t// At this point, it's related to the host/port\n\tvar related = true;\n\tvar parentIndex = -1;\n\t\n\t// Find parents\n\tsiteAbsolutePath.forEach( function(siteAbsoluteDir, i)\n\t{\n\t\tif (related)\n\t\t{\n\t\t\tif (absolutePath[i] !== siteAbsoluteDir)\n\t\t\t{\n\t\t\t\trelated = false;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tparentIndex = i;\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (!related)\n\t\t{\n\t\t\t// Up one level\n\t\t\trelativePath.push(\"..\");\n\t\t}\n\t});\n\t\n\t// Form path\n\tabsolutePath.forEach( function(dir, i)\n\t{\n\t\tif (i > parentIndex)\n\t\t{\n\t\t\trelativePath.push(dir);\n\t\t}\n\t});\n\t\n\treturn relativePath;\n}\n\n\n\nfunction relativize(urlObj, siteUrlObj, options)\n{\n\tif (urlObj.extra.relation.minimumScheme)\n\t{\n\t\tvar pathArray = relatePath(urlObj.path.absolute.array, siteUrlObj.path.absolute.array);\n\t\t\n\t\turlObj.path.relative.array  = pathArray;\n\t\turlObj.path.relative.string = pathUtils.join(pathArray);\n\t}\n}\n\n\n\nmodule.exports = relativize;\n"]}